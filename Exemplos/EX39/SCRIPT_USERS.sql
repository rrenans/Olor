DROP DATABASE IF EXISTS DBCARTAOCREDITO;

CREATE DATABASE DBCARTAOCREDITO;

USE DBCARTAOCREDITO;

CREATE TABLE CLIENTE (
	IDCLIENTE INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(100) NOT NULL,
	CPF CHAR(11) NOT NULL,
	RG VARCHAR(16),
	LOGRADOURO VARCHAR(100),
	NUMERO VARCHAR(10),
	BAIRRO VARCHAR(100),
	CIDADE VARCHAR(100),
	UF CHAR(2),
	COMPLEMENTO VARCHAR(100),
	DT_NASCIMENTO DATE,
	TELEFONE_RESIDENCIAL VARCHAR(15),
	TELEFONE_COMERCIAL VARCHAR(15),
	TELEFONE_RECADO VARCHAR(15)
);

CREATE TABLE CARTAO (
	IDCARTAO INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	IDCLIENTE INT NOT NULL,
	NUMERO CHAR(17) NOT NULL,
	DIA_VENCIMENTO INT NOT NULL,
	LIMITE NUMERIC(8,2),
	CONSTRAINT FK_CARTAO_CLIENTE FOREIGN KEY (IDCLIENTE) REFERENCES CLIENTE(IDCLIENTE)
);

CREATE TABLE DEBITO (
	IDDEBITO INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	IDCARTAO INT NOT NULL,
	DESCRICAO VARCHAR(255) NOT NULL,
	PARCELA INT,
	VALOR NUMERIC(8,2) NOT NULL, 
	DT_DEBITO DATETIME,
	CONSTRAINT FK_DEBITO_CARTAO FOREIGN KEY (IDCARTAO) REFERENCES CARTAO(IDCARTAO)
);

CREATE TABLE BOLETO (
	IDBOLETO INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	IDCARTAO INT NOT NULL,
	DT_GERACAO DATE NOT NULL,
	DT_VENCIMENTO DATE NOT NULL,
	VALOR_TOTAL NUMERIC(8,2) NOT NULL, 
	DT_PAGAMENTO DATE,
	VALOR_PAGO NUMERIC(8,2), 
	CONSTRAINT FK_BOLETO_CLIENTE FOREIGN KEY (IDCARTAO) REFERENCES CARTAO(IDCARTAO)
);

CREATE TABLE ITEM_BOLETO (
	IDITEM_BOLETO INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	IDBOLETO INT NOT NULL,
	IDDEBITO INT NOT NULL,
	CONSTRAINT FK_ITEM_BOLETO_BOLETO FOREIGN KEY (IDBOLETO) REFERENCES BOLETO(IDBOLETO),
	CONSTRAINT FK_ITEM_BOLETO_DEBITO FOREIGN KEY (IDDEBITO) REFERENCES DEBITO(IDDEBITO)
);

INSERT INTO CLIENTE(IDCLIENTE, NOME, CPF, RG, LOGRADOURO, NUMERO, BAIRRO, CIDADE, UF, COMPLEMENTO, DT_NASCIMENTO, TELEFONE_RESIDENCIAL, TELEFONE_COMERCIAL, TELEFONE_RECADO)VALUES(1, 'JOAO DA SILVA', '11111111111', '123456789', 'RUA A', 1, 'CENTRO', 'FLORIANOPOLIS', 'SC', 'CASA', '2001-01-01', '48999999999', '4833773377', '4833663366');
INSERT INTO CLIENTE(IDCLIENTE, NOME, CPF, RG, LOGRADOURO, NUMERO, BAIRRO, CIDADE, UF, COMPLEMENTO, DT_NASCIMENTO, TELEFONE_RESIDENCIAL, TELEFONE_COMERCIAL, TELEFONE_RECADO)VALUES(2, 'MARIA DA SILVA', '22222222222', '123456780', 'RUA B', 2, 'CENTRO', 'FLORIANOPOLIS', 'SC', 'CASA', '2001-01-02', '48999999998', '4833773371', '4833663364');

INSERT INTO CARTAO(IDCARTAO, IDCLIENTE, NUMERO, DIA_VENCIMENTO, LIMITE)VALUES(1, 1, '000001', 15, 1000);
INSERT INTO CARTAO(IDCARTAO, IDCLIENTE, NUMERO, DIA_VENCIMENTO, LIMITE)VALUES(2, 2, '000002', 10, 5000);

INSERT INTO DEBITO (IDDEBITO, IDCARTAO, DESCRICAO, PARCELA, VALOR, DT_DEBITO)VALUES(1, 1, 'COMPRA MERCADO', 1, 10, '2018-01-01');
INSERT INTO DEBITO (IDDEBITO, IDCARTAO, DESCRICAO, PARCELA, VALOR, DT_DEBITO)VALUES(2, 1, 'COMPRA MERCADO', 2, 15, '2018-01-01');
INSERT INTO DEBITO (IDDEBITO, IDCARTAO, DESCRICAO, PARCELA, VALOR, DT_DEBITO)VALUES(3, 2, 'COMPRA MERCADO', 1, 10, '2018-01-01');
INSERT INTO DEBITO (IDDEBITO, IDCARTAO, DESCRICAO, PARCELA, VALOR, DT_DEBITO)VALUES(4, 2, 'COMPRA MERCADO', 2, 15, '2018-01-01');

INSERT INTO BOLETO (IDBOLETO, IDCARTAO, DT_GERACAO, DT_VENCIMENTO, VALOR_TOTAL)VALUES(1, 1, NOW(), NOW() + 10, 25);
INSERT INTO BOLETO (IDBOLETO, IDCARTAO, DT_GERACAO, DT_VENCIMENTO, VALOR_TOTAL)VALUES(2, 2, NOW(), NOW() + 10, 25);

INSERT INTO ITEM_BOLETO (IDITEM_BOLETO, IDBOLETO, IDDEBITO)VALUES(1, 1, 1);
INSERT INTO ITEM_BOLETO (IDITEM_BOLETO, IDBOLETO, IDDEBITO)VALUES(2, 1, 2);
INSERT INTO ITEM_BOLETO (IDITEM_BOLETO, IDBOLETO, IDDEBITO)VALUES(3, 2, 3);
INSERT INTO ITEM_BOLETO (IDITEM_BOLETO, IDBOLETO, IDDEBITO)VALUES(4, 2, 4);




SELECT HOST, USER FROM MYSQL.USER;

CREATE USER 'ADRIANA'@'%' IDENTIFIED BY '123456'; 
CREATE USER 'ALFREDO'@'%' IDENTIFIED BY '123456';
CREATE USER 'ANA'@'%' IDENTIFIED BY '123456';
CREATE USER 'ANDERSON'@'%' IDENTIFIED BY '123456';
CREATE USER 'ANDRESSA'@'%' IDENTIFIED BY '123456';
CREATE USER 'BRUNA'@'%' IDENTIFIED BY '123456';
CREATE USER 'CARLA'@'%' IDENTIFIED BY '123456';

 
GRANT SELECT, UPDATE ON DBCARTAOCREDITO.CARTAO TO 'ADRIANA'@'%';
GRANT SELECT ON DBCARTAOCREDITO.* TO 'ALFREDO'@'%';
GRANT SELECT, UPDATE, INSERT ON DBCARTAOCREDITO.* TO 'ANA'@'%';
GRANT SELECT ON DBCARTAOCREDITO.CARTAO TO 'ANDERSON'@'%';
GRANT SELECT, INSERT ON DBCARTAOCREDITO.CLIENTE TO 'BRUNA'@'%';
GRANT SELECT ON DBCARTAOCREDITO.BOLETO TO 'BRUNA'@'%';
GRANT SELECT, INSERT, UPDATE, DELETE ON DBCARTAOCREDITO.CARTAO TO 'CARLA'@'%';
GRANT SELECT ON DBCARTAOCREDITO.* TO 'CARLA'@'%';


SHOW GRANTS FOR 'ADRIANA'@'%';
SHOW GRANTS FOR 'ALFREDO'@'%';
SHOW GRANTS FOR 'ANA'@'%';
SHOW GRANTS FOR 'ANDERSON'@'%';
SHOW GRANTS FOR 'ANDRESSA'@'%';
SHOW GRANTS FOR 'BRUNA'@'%';
SHOW GRANTS FOR 'CARLA'@'%';


FLUSH PRIVILEGES;